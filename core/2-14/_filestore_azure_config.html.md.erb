To use external Azure file storage for your <%= vars.app_runtime_abbr %> filestore:

1. Select **External Azure storage**.

1. To create a new storage account for the <%= vars.app_runtime_abbr %> filestore:
  1. Navigate to the Azure Portal.
  1. Select the **Storage accounts** tab.
  1. Click the **+** icon to add a new storage account.
  1. In the **Name** field, enter a unique name for the storage account. This name must be
  all lowercase and contain 3 to 24 alphanumeric characters.
  1. For **Deployment model**, select **Resource manager**.
  1. From the **Account kind** dropdown, select **General purpose**.
  1. For **Performance**, select **Standard**.
  1. From the **Replication** dropdown, select **Locally-redundant storage (LRS)**.
  1. For **Storage service encryption**, select **Disabled**.
  1. From the **Subscription** dropdown, select the subscription where you want to deploy
  <%= vars.app_runtime_abbr %> resources.
  1. For **Resource group**, select **Use existing** and enter the name of the resource group
  where you deployed <%= vars.app_runtime_abbr %>.
  1. From the **Location** dropdown, select the location where you are deploying
  <%= vars.app_runtime_abbr %>.
  1. Click **Create**.

1. To create new storage containers in the storage account you created in the previous step:
  1. In the Azure Portal, select the new storage account from the dashboard.
  1. Under **Blob Service**, select **Containers** to create one or more containers in this
  storage account for buildpacks, droplets, resources, and packages.
  1. Select **Soft Delete**.
  1. Select **Enabled** to enable soft delete in your Azure storage account.
    <p class='note'><strong>Note:</strong> BBR requires that you enable soft delete in your
    Azure storage account before you enable backup and restore for your Azure blobstores
    in <%= vars.ops_manager %>. You should set a reasonable retention policy to minimize
    storage costs. For more information on enabling soft delete in your Azure storage account,
    see <a href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-soft-delete#quickstart">
    Soft delete for blobs</a> in the Azure documentation.</p>
  1. For each container that you create, set the **Access type** to **Private**.

1. In <%= vars.app_runtime_abbr %>, enter the name of the storage account you created for
**Account name**.

1. In the **Access key** field, enter one of the access keys provided for the storage account.
To obtain a value for this field:
  1. Navigate to the Azure Portal.
  1. Select the **Storage accounts** tab.
  1. Click **Access keys**.

1. For **Environment**, enter the name of the Azure Cloud environment that contains your
storage. This value defaults to AzureCloud, but other options include AzureChinaCloud,
AzureUSGovernment, and AzureGermanCloud.

1. For **Buildpacks container name**, enter the container name for storing your app buildpacks.

1. For **Droplets container name**, enter the container name for your app droplet storage.
<%= vars.company_name %> recommends that you use a unique container name, but you can use
the same container name as the previous step.

1. For **Packages container name**, enter the container name for packages. <%= vars.company_name %>
recommends that you use a unique container name, but you can use the same container name as
the previous step.

1. For **Resources container name**, enter the container name for resources. <%= vars.company_name %>
recommends that you use a unique container name, but you can use the same container name as
the previous step.

1. (Optional) To enable backup and restore for your Azure blobstores in <%= vars.app_runtime_abbr %>,
select the **Enable backup and restore** checkbox.
  <p class='note'><strong>Note:</strong> Soft deletes must be enabled for all storage containers
    listed.</p>

1. (Optional) To enable <%= vars.app_runtime_abbr %> to restore your containers to a different
Azure storage account than the account where you take backups:
  1. Under **Restore from storage account**, enter the name of the Azure storage account
  you want to restore your containers from. Leave this field blank if you want to restore
  to the same storage account where you take backups.
  1. Under **Restore using access key**, enter the access key for the Azure storage account
  you specified in **Restore from storage account**. Leave this field blank if you want to
  restore to the same storage account where you take backups.

1. Click **Save**.

<p class="note"><strong>Note:</strong> To enable backup and restore of your <%= vars.app_runtime_abbr %>
  tile that uses an S3-compatible blobstore, see <a href="https://docs.pivotal.io/ops-manager/2-10/install/backup-restore/enabling-external-blobstore-backups.html">Enable External Blobstore Backups</a>.</p>
